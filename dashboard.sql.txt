SELECT 
  visit_date,
  sum(leads_count),
  SUM(leads_count) OVER () AS total_leads,
  ROUND(SUM(leads_count) OVER (ORDER BY visit_date) * 100.0 / SUM(leads_count) OVER (), 2) AS percentage
FROM voronka
group by visit_date
ORDER BY visit_date

SELECT sum(visitors_count), utm_source,  sum(total_cost), sum(revenue)
from voronka 
where utm_source = 'vk' or utm_source = 'yandex'
group by utm_source
order by revenue DESC NULLS LAST;

SELECT 
*,
total_cost / visitors_count as cpu,
total_cost / leads_count as cpl,
total_cost / purchases_count as cppu,
(revenue - total_cost) / total_cost * 100 as roi
from voronka;